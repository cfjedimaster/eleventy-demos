---
layout: post
title: "CFFEED - You have failed me for the last time."
date: "2008-08-29T14:08:00+06:00"
categories: [coldfusion]
tags: []
banner_image: 
permalink: /2008/08/29/CFFEED-You-have-failed-me-for-the-last-time
guid: 2995
---

<img src="https://static.raymondcamden.com/images/cfjedi/fail.gif" align="left" alt="This is your CFML. This is your CFML with cffeed." style="margin-right:10px;margin-bottom:10px">
Ugh. I give up. Today a customer of ours at <a href="http://www.broadchoice.com">Broadchoice</a> ran into a bug with an RSS feed. The feed was being generated by cffeed of course. What was interesting is that this was a whole new bug for me. Yes, another one. I swear I love ColdFusion. Really, I do. I just don't know why this one darn tag seems to trouble me so much. I swear this tag has a personal vendetta against me. So what went wrong this time?
<br clear="left">
<!--more-->
The error was thrown by CFFEED. It wasn't an error on display, like what I describe <a href="http://www.raymondcamden.com/index.cfm/2007/8/13/Bug-to-watch-out-for-with-CFFEED">here</a>. I carefully read over the content that was being used for the feed data and then I saw it. The mysterious box of doom I like to call it. The character that obviously was pasted from some Word document, or other source, that got fubared when rendered. 

It took me a while, but I was able to narrow down the character (19) and expose the error a bit. To see this in action, I modified the code from the <a href="http://www.coldfusionjedi.com/index.cfm/2007/8/13/Bug-to-watch-out-for-with-CFFEED">blog entry</a> mentioned above. 

<code>

&lt;cfset getEntries = queryNew("publisheddate,content,title")&gt;

&lt;cfset queryAddRow(getEntries)&gt;
&lt;cfset querySetCell(getEntries,"title", "LAST ENTRY")&gt;
&lt;cfset querySetCell(getEntries,"content", "&lt;b&gt;Test&lt;/b&gt;")&gt;
&lt;cfset querySetCell(getEntries,"publisheddate", now())&gt;

&lt;cfset queryAddRow(getEntries)&gt;
&lt;cfset querySetCell(getEntries,"title", "LAST ENTRY2")&gt;
&lt;cfset querySetCell(getEntries,"content", "#chr(8220)#Test#chr(8220)# #chr(19)#")&gt;
&lt;cfset querySetCell(getEntries,"publisheddate", now())&gt;

&lt;cfset props = {% raw %}{version="rss_2.0",title="Test Feed",link="http://127.0.0.1",description="Test"}{% endraw %}&gt;



&lt;cffeed action="create" properties="#props#" query="#getEntries#" xmlVar="result"&gt;

&lt;cfcontent type="text/xml" reset="true"&gt;&lt;cfoutput&gt;#result#&lt;/cfoutput&gt;
</code>

Note the data in the second query row. I added the chr(19) to the end. Now unlike the problem in the other blog entry (which resulted in Firefox not showing the complete feed), this one threw a real exception:

<blockquote>
<p>
The input values might be invalid. The reason for exception is : <br> The data "Test X" is not legal for a JDOM character content: 0x13 is not a legal XML character.
</p>
</blockquote>

As just an FYI, the "X" above was the literal bad character. I replied it so as to not cause any possible problems in my own RSS feed here. 

Great. Not a legal XML character. Hey, I bet xmlFormat() will fix it, right? Of course not. As I said in the beginning. Ugh.

So to fix it, I modified the UDF mentioned in the earlier blog entry to just replace chr(19) with nothing. 

You know - I get that different encodings can impact whats valid in XML. But would it be that hard to ask cffeed to sniff the current settings and just remove what isn't valid? Especially since it will be (most likely) crap characters like funky quotes or the like? Seriously - am I the only one having so much trouble with cffeed?